<html>
<body>
  <h1>Test Chat Heylight</h1>
  <!-- Custom Chat Launcher -->
  <div id="custom-chat-launcher" class="custom-launcher-tab">Serve aiuto?</div>
  <style>
    .custom-launcher-tab {
      position: fixed;
      bottom: 20px;
      right: 20px;
      background-color: #EA1C00;
      color: white;
      padding: 12px 24px;
      border-radius: 4px;
      cursor: pointer;
      font-weight: 500;
      font-size: 14px;
      z-index: 9998;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
      transition: all 0.3s ease;
    }
    .custom-launcher-tab:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
    }
    .custom-launcher-tab.loading {
      opacity: 0.8;
    }
  </style>
  <script type='text/javascript'>
    function initEmbeddedMessaging() {
      try {
        embeddedservice_bootstrap.settings.language = 'it';
        // Quando il launcher di Salesforce Ã¨ creato, nascondilo
        window.addEventListener('onEmbeddedMessagingButtonCreated', () => {
          console.log('Salesforce launcher created - hiding');
          const defaultLauncher = document.querySelector('[data-testid="embeddedMessagingLauncher"]');
          if (defaultLauncher) {
            defaultLauncher.style.display = 'none';
          }
        });
        // Quando l'utente clicca sul launcher di Salesforce
        window.addEventListener('onEmbeddedMessagingButtonClicked', () => {
          console.log('Salesforce launcher clicked');
          updateLauncherText('Un attimo e arriviamo!');
        });
        window.addEventListener('onEmbeddedMessagingReady', () => {
          console.log('Embedded Messaging Ready');
          window.embeddedservice_bootstrap.prechatAPI.setHiddenPrechatFields({
            "ActionName": "Supporto Heylight",
            "Origin": "Portale HeyLight",
            "Categoria": "Categoria Portale HeyLight 3",
            "RawActionName": "Supporto",
            "ProductName": "Prodotto di test",
            "MerchantName": "Heylight",
            "MerchantID": "5498730",
            "SessionID": "453455498730",
            "OpsApplicationUrl": "https://www.google.com/",
            "OriginationChannel": "Test Origination Channel"
          });
          // Aggiungi listener al custom launcher
          const customLauncher = document.getElementById('custom-chat-launcher');
          if (customLauncher) {
            customLauncher.addEventListener('click', () => {
              console.log('Custom launcher clicked - starting chat');
              window.embeddedservice_bootstrap.startChat();
              updateLauncherText('Un attimo e arriviamo!');
            });
          }
        });
        embeddedservice_bootstrap.init(
          '00D9X00000FicnO',
          'test2_fg',
          'https://compasscrm--uat3.sandbox.my.site.com/ESWtest2fg1765897989768',
          {
            scrt2URL: 'https://compasscrm--uat3.sandbox.my.salesforce-scrt.com'
          }
        );
      } catch (err) {
        console.error('Error loading Embedded Messaging: ', err);
      }
    };
    // Funzione per aggiornare il testo del launcher
    function updateLauncherText(text) {
      const launcher = document.getElementById('custom-chat-launcher');
      if (launcher) {
        launcher.textContent = text;
        launcher.classList.add('loading');
      }
    }
  </script>
  <script type='text/javascript' src='https://compasscrm--uat3.sandbox.my.site.com/ESWtest2fg1765897989768/assets/js/bootstrap.min.js' onload='initEmbeddedMessaging()'></script>
</body>
</html>
